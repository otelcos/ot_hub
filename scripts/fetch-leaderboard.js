const fs = require('fs');
const path = require('path');

// Local source: generated by evals/leaderboard/aggregate_results.py
const SOURCE_PATH = path.join(__dirname, '../../evals/leaderboard/leaderboard.json');
const OUTPUT_PATH = path.join(__dirname, '../static/data/leaderboard.json');

function copyLeaderboard() {
  console.log('Loading leaderboard data from local evals...');

  if (!fs.existsSync(SOURCE_PATH)) {
    throw new Error(
      `Source file not found: ${SOURCE_PATH}\n` +
      'Run: cd evals && uv run python leaderboard/aggregate_results.py'
    );
  }

  const data = fs.readFileSync(SOURCE_PATH, 'utf-8');
  const parsed = JSON.parse(data);

  // Ensure output directory exists
  fs.mkdirSync(path.dirname(OUTPUT_PATH), { recursive: true });

  // Write the data
  fs.writeFileSync(OUTPUT_PATH, JSON.stringify(parsed, null, 2));
  console.log(`Leaderboard data written to ${OUTPUT_PATH} (${parsed.rows.length} models)`);
}

try {
  copyLeaderboard();
} catch (err) {
  console.error('Error loading leaderboard:', err.message);
  process.exit(1);
}
